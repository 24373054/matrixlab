#!/bin/bash
# Matrix Lab ç½‘ç«™ä¸€é”®å¯åŠ¨è„šæœ¬

SERVICE_NAME="nginx"
LOG_FILE="/var/log/matrixlab-website-control.log"

# ç¡®ä¿æ—¥å¿—æ–‡ä»¶å­˜åœ¨ä¸”å¯å†™
sudo touch $LOG_FILE
sudo chmod 644 $LOG_FILE

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”" | tee -a $LOG_FILE
echo "  ğŸš€ æ­£åœ¨å¯åŠ¨ Matrix Lab ç½‘ç«™æœåŠ¡..." | tee -a $LOG_FILE
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”" | tee -a $LOG_FILE
echo "å¯åŠ¨æ—¶é—´: $(date)" | tee -a $LOG_FILE
echo "" | tee -a $LOG_FILE

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
if systemctl is-active --quiet $SERVICE_NAME; then
    echo "âš ï¸  Nginx æœåŠ¡å·²ç»åœ¨è¿è¡Œã€‚" | tee -a $LOG_FILE
    echo "" | tee -a $LOG_FILE
    echo "ç½‘ç«™åœ°å€: https://matrixlab.work" | tee -a $LOG_FILE
    echo "" | tee -a $LOG_FILE
else
    echo "å°è¯•å¯åŠ¨ Nginx æœåŠ¡..." | tee -a $LOG_FILE
    sudo systemctl start $SERVICE_NAME >> $LOG_FILE 2>&1
    
    # ç­‰å¾…æœåŠ¡å¯åŠ¨
    sleep 2
    
    # å†æ¬¡æ£€æŸ¥çŠ¶æ€
    if systemctl is-active --quiet $SERVICE_NAME; then
        echo "âœ… Nginx æœåŠ¡å¯åŠ¨æˆåŠŸï¼" | tee -a $LOG_FILE
        echo "" | tee -a $LOG_FILE
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”" | tee -a $LOG_FILE
        echo "  ğŸŒ ç½‘ç«™ä¿¡æ¯" | tee -a $LOG_FILE
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”" | tee -a $LOG_FILE
        echo "  ä¸»é¡µ: https://matrixlab.work" | tee -a $LOG_FILE
        echo "  Publications: https://matrixlab.work/publications.html" | tee -a $LOG_FILE
        echo "  People: https://matrixlab.work/people.html" | tee -a $LOG_FILE
        echo "" | tee -a $LOG_FILE
        echo "  æŸ¥çœ‹è®¿é—®æ—¥å¿—: sudo tail -f /var/log/nginx/matrixlab_access.log" | tee -a $LOG_FILE
        echo "  æŸ¥çœ‹é”™è¯¯æ—¥å¿—: sudo tail -f /var/log/nginx/matrixlab_error.log" | tee -a $LOG_FILE
        echo "  åœæ­¢æœåŠ¡: ./stop" | tee -a $LOG_FILE
        echo "" | tee -a $LOG_FILE
    else
        echo "âŒ Nginx æœåŠ¡å¯åŠ¨å¤±è´¥ï¼" | tee -a $LOG_FILE
        echo "" | tee -a $LOG_FILE
        echo "è¯·æ£€æŸ¥æ—¥å¿—è·å–æ›´å¤šä¿¡æ¯ï¼š" | tee -a $LOG_FILE
        echo "  sudo journalctl -u nginx --since \"5 minutes ago\"" | tee -a $LOG_FILE
        echo "  æˆ–æŸ¥çœ‹ /var/log/nginx/error.log" | tee -a $LOG_FILE
        echo "" | tee -a $LOG_FILE
    fi
fi

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”" | tee -a $LOG_FILE
echo "æ“ä½œå®Œæˆã€‚" | tee -a $LOG_FILE
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”" | tee -a $LOG_FILE

